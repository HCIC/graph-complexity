<script src="https://d3js.org/d3.v4.js"></script>
<svg id="graphsvg">
<g id="edgelines"></g>
<g id="vertexcircles"></g>
</svg>
<script>
  var width = 600;
  var height = 600;

  var vertexRadius = 10;
  var vertexColor = "black";
  var edgeColor = "black";

  var repelStrength = -100;
  var gravityStrength = 0.03;
  //TODO: browser
  //TODO: screen resolution
  //TODO: vertex color
  //TODO: edge color
  //TODO: loading screen?

  function gilbert(n, p) {
    var v = [];
    for (var i = 0; i < n; i++) {
      v.push({
        "id": String(i)
      });
    }
    var e = [];
    for (var i = 0; i < v.length; i++) {
      for (var j = i + 1; j < v.length; j++) {
        if (Math.random() <= p) {
          e.push({
            "source": String(i),
            "target": String(j)
          });
        }
      }
    }
    return {
      "vertices": v,
      "edges": e
    };
  }

  var graph = gilbert(20, 0.1)

  /*  var vertices = [{
      "id": "Alice"
    }, {
      "id": "Bob"
    }, {
      "id": "Carol"
    }];

    var edges = [{
      "source": "Alice",
      "target": "Bob"
    }, {
      "source": "Bob",
      "target": "Carol"
    }];
    */

  d3.select("#graphsvg")
    .attr("width", width)
    .attr("height", height)
    .style("border", "1px solid black")

  var simulation = d3.forceSimulation()
    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("gravityx", d3.forceX(width / 2).strength(gravityStrength))
    .force("gravityy", d3.forceY(height / 2).strength(gravityStrength))
    .force("charge", d3.forceManyBody().strength(repelStrength))
    .force("link", d3.forceLink().id(function(d) {
      return d.id;
    }))
    .force("collide", d3.forceCollide(vertexRadius));

  simulation.nodes(graph.vertices);
  simulation.force("link").links(graph.edges);

  simulation.on("end", function() {
    d3.select("#vertexcircles").selectAll("circle").data(graph.vertices).enter()
      .append("circle")
      .attr("r", vertexRadius)
      .attr("cx", function(d) {
        return d.x;
      })
      .attr("cy", function(d) {
        return d.y;
      })
      .attr("fill", vertexColor)

    d3.select("#edgelines").selectAll("line").data(graph.edges).enter()
      .append("line")
      .attr("x1", function(d) {
        return d.source.x;
      })
      .attr("y1", function(d) {
        return d.source.y;
      })
      .attr("x2", function(d) {
        return d.target.x;
      })
      .attr("y2", function(d) {
        return d.target.y;
      })
      .attr("stroke", edgeColor)
  });
</script>
